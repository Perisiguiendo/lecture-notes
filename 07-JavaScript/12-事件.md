# äº‹ä»¶

##  äº‹ä»¶

### ç»‘å®š

- `ele.onxxxx = function (event) {}`ï¼šå…¼å®¹æ€§å¥½ï¼Œä½†æ˜¯ä¸€ä¸ªå…ƒç´ çš„åŒä¸€ä¸ªäº‹ä»¶ä¸Šåªèƒ½ç»‘å®šä¸€ä¸ªå¤„ç†å‡½æ•°ã€‚åŸºæœ¬ç­‰åŒäºå†™åœ¨HTMLè¡Œé—´ä¸Šã€‚

- `obj.addEventListener(type, fn, false)`ï¼šIE9 ä»¥ä¸‹ä¸å…¼å®¹ï¼Œå¯ä»¥ä¸ºå¤šä¸ªäº‹ä»¶ç»‘å®šå¤šä¸ªå¤„ç†ç¨‹åº
- `obj.attachEvent('on'+type, fn)`ï¼šIE ç‹¬æœ‰ï¼Œä¸€ä¸ªäº‹ä»¶åŒæ ·å¯ä»¥ç»‘å®šå¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åº

### this æŒ‡å‘

- `ele.onxxxx = function (event) {}`ï¼šç¨‹åº this æŒ‡å‘çš„æ˜¯ dom å…ƒç´ æœ¬èº«

- `obj.addEventListener(type, fn, false)`ï¼šç¨‹åº this æŒ‡å‘æ˜¯ dom å…ƒç´ æœ¬èº«

- `obj.attachEvent('on'+type, fn)`ï¼šç¨‹åº this æŒ‡å‘ window

- å°è£…å…¼å®¹æ€§çš„ `addEvent(elem, type, handle)` æ–¹æ³•

```javascript
function addEvent(elem, type, handle) {
	if(elem.addEventListener) {
		elem.addEventListener(type, handle, false);
	} else if (elem.attachEvent) {
		elem.attachEvent('on' + type, function () {
			handle.call(elem);
		})
	} else {
		elem['on' + type] = handle;
	}
}
```

###  è§£é™¤äº‹ä»¶å¤„ç†ç¨‹åº

- `ele.onclick = false / null;`
- `ele.removeEventListener(type, fn, false);`
- `ele.detachEvent('on' + type, fn);`
- `æ³¨`ï¼šè‹¥ç»‘å®šåŒ¿åå‡½æ•°ï¼Œåˆ™æ— æ³•æ¸…é™¤
- ä¸¾ä¸ªæ —å­

```javascript
var div = document.getElementsByTagName('div')[0];
div.addEventListener('click', test, false);
function test () {
	console.log('test');
}
div.removeEventListener('click', test, false);
```

###  äº‹ä»¶å¤„ç†æ¨¡å‹

####  1. äº‹ä»¶å†’æ³¡

- ç»“æ„ä¸Šï¼ˆéè§†è§‰ä¸Šï¼‰åµŒå¥—å…³ç³»çš„å…ƒç´ ï¼Œä¼šå­˜åœ¨äº‹ä»¶å†’æ³¡çš„åŠŸèƒ½ï¼Œå³åŒä¸€äº‹ä»¶ï¼Œè‡ªå­å…ƒç´ å†’æ³¡å‘çˆ¶å…ƒç´ ã€‚ï¼ˆè‡ªåº•å‘ä¸Šï¼‰


####  2. äº‹ä»¶æ•è·

- ç»“æ„ä¸Šï¼ˆéè§†è§‰ä¸Šï¼‰åµŒå¥—å…³ç³»çš„å…ƒç´ ä¼šå­˜åœ¨äº‹ä»¶æ•è·çš„åŠŸèƒ½ï¼Œå³åŒä¸€äº‹ä»¶ï¼Œè‡ªçˆ¶å…ƒç´ æ•è·è‡³å­å…ƒç´ ï¼ˆäº‹ä»¶æºå…ƒç´ ï¼‰ã€‚ï¼ˆè‡ªé¡¶å‘ä¸‹ï¼‰
- IE æ²¡æœ‰äº‹ä»¶æ•è·

####  3. è§¦å‘é¡ºåº

- å…ˆæ•è·ï¼Œåå†’æ³¡

####  4. ä¸å†’æ³¡çš„äº‹ä»¶

- focus
- blur
- change
- submit
- reset
- select
- ...

####  5. å–æ¶ˆäº‹ä»¶å†’æ³¡

- W3C æ ‡å‡† `event.stopPropagation();`ï¼Œä¸æ”¯æŒ IE9 ä»¥ä¸‹çš„ç‰ˆæœ¬
- IE ç‹¬æœ‰ `event.cancelBubble = true;`
- å°è£…å–æ¶ˆå†’æ³¡çš„å‡½æ•° `stopBubble(event)`

```javascript
function stopBubble(event) {
	if(event.stopPropagation) {
		event.stopPropagation();
	} else {
		event.cancelBubble = true;
	}
}
```

####  6. é˜»æ­¢é»˜è®¤äº‹ä»¶

- é»˜è®¤äº‹ä»¶ â€”â€” è¡¨å•æäº¤ï¼Œa æ ‡ç­¾è·³è½¬ï¼Œå³é”®èœå•ç­‰
  1. `return false;` ä»¥å¯¹è±¡å±æ€§çš„æ–¹å¼æ³¨å†Œçš„äº‹ä»¶æ‰ç”Ÿæ•ˆ
  2. `event.preventDefault();` W3C æ ‡å‡†ï¼ŒIE9 ä»¥ä¸‹ä¸å…¼å®¹
  3. `event.returnValue = false;` å…¼å®¹ IE
  4. å°è£…é˜»æ­¢é»˜è®¤äº‹ä»¶çš„å‡½æ•° cancelHandler(event)

```javascript
function cancelHandler(event) {
	if(event.preventDefault) {
		event.preventDefault();
	} else {
		event.returnValue = false;
	}
}
```



###  äº‹ä»¶å¯¹è±¡

- `event || window.event`

####  1. äº‹ä»¶æºå¯¹è±¡

- `event.target`ï¼šç«ç‹åªæœ‰è¿™ä¸ª
- `event.srcElement`ï¼šIEåªæœ‰è¿™ä¸ª
- chrome éƒ½æœ‰

####  2. å…¼å®¹æ€§å†™æ³•

```javascript
var target = e.target || e.srcElement;
```

###  äº‹ä»¶å§”æ‰˜

- åˆ©ç”¨äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æºå¯¹è±¡è¿›è¡Œå¤„ç†
- ä¼˜ç‚¹ï¼š
  - æ€§èƒ½ï¼šä¸éœ€è¦å¾ªç¯æ‰€æœ‰çš„å…ƒç´ ï¼Œç»™æ¯ä¸€ä¸ªå…ƒç´ ç»‘å®šäº‹ä»¶

  - çµæ´»ï¼šå½“æœ‰æ–°çš„å­å…ƒç´ æ—¶ï¼Œä¸éœ€è¦é‡æ–°ç»‘å®šäº‹ä»¶

 ###  äº‹ä»¶åˆ†ç±»

####  1. é¼ æ ‡äº‹ä»¶

- click
- mousedown
- moousemove
- mouseup
- contextmenuï¼šå³é”®äº§ç”Ÿèœå•äº‹ä»¶
- mouseover
- mouseout
- mouseenterï¼šh5æ–°è§„èŒƒ
- mouseleaveï¼šh5æ–°è§„èŒƒ

####  2. é”®ç›˜äº‹ä»¶

- keydownã€keyupã€keypress
- keydown > keypress > keyup
- keydown å’Œ keypress çš„åŒºåˆ«
  - keydown å¯ä»¥å“åº”ä»»æ„é”®ç›˜æŒ‰é”®ï¼Œkeypress åªèƒ½å“åº”å­—ç¬¦ç±»é”®ç›˜æŒ‰é”®

  - keypress è¿”å› ASCII ç ï¼Œå¯ä»¥è½¬æ¢ä¸ºç›¸åº”çš„å­—ç¬¦

####  3. æ–‡æœ¬æ“ä½œäº‹ä»¶

- input
- focu
- blur
- change

####  4. çª—ä½“æ“ä½œç±»ï¼ˆwindowä¸Šçš„äº‹ä»¶ï¼‰

- scroll
- load



## äº‹ä»¶æµ

JS ä¸ HTML çš„äº¤äº’æ˜¯ç”¨äº‹ä»¶å®ç°çš„ã€‚äº‹ä»¶æµæè¿°äº†é¡µé¢æ¥æ”¶äº‹ä»¶çš„é¡ºåºã€‚



##  äº‹ä»¶å¾ªç¯ã€äº‹ä»¶å†’æ³¡

äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·åˆ†åˆ«ç”±å¾®è½¯å’Œç½‘è­¦å…¬å¸æå‡ºï¼Œè¿™ä¸¤ä¸ªæ¦‚å¿µéƒ½æ˜¯ä¸ºäº†è§£å†³é¡µé¢ä¸­**äº‹ä»¶æµ**ï¼ˆäº‹ä»¶å‘ç”Ÿé¡ºåºï¼‰çš„é—®é¢˜ã€‚

```html
<div id="outer">
    <p id="inner">Click me!</p>
</div>
```

ä¸Šé¢çš„ä»£ç å½“ä¸­ä¸€ä¸ªdivå…ƒç´ å½“ä¸­æœ‰ä¸€ä¸ªpå­å…ƒç´ ï¼Œå¦‚æœä¸¤ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªclickçš„å¤„ç†å‡½æ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬æ€ä¹ˆæ‰èƒ½çŸ¥é“å“ªä¸€ä¸ªå‡½æ•°ä¼šé¦–å…ˆè¢«è§¦å‘å‘¢ï¼Ÿ

ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜å¾®è½¯å’Œç½‘æ™¯æå‡ºäº†ä¸¤ç§å‡ ä¹å®Œå…¨ç›¸åçš„æ¦‚å¿µã€‚

### äº‹ä»¶å†’æ³¡

å¾®è½¯æå‡ºäº†åä¸º**äº‹ä»¶å†’æ³¡**(event bubbling)çš„äº‹ä»¶æµã€‚

äº‹ä»¶å†’æ³¡å¯ä»¥å½¢è±¡åœ°æ¯”å–»ä¸ºæŠŠä¸€é¢—çŸ³å¤´æŠ•å…¥æ°´ä¸­ï¼Œæ³¡æ³¡ä¼šä¸€ç›´ä»æ°´åº•å†’å‡ºæ°´é¢ã€‚äº‹ä»¶ä¼šä»æœ€å†…å±‚çš„å…ƒç´ å¼€å§‹å‘ç”Ÿï¼Œä¸€ç›´å‘ä¸Šä¼ æ’­ï¼Œç›´åˆ°documentå¯¹è±¡ã€‚

å› æ­¤ä¸Šé¢çš„ä¾‹å­åœ¨äº‹ä»¶å†’æ³¡çš„æ¦‚å¿µä¸‹å‘ç”Ÿclickäº‹ä»¶çš„é¡ºåºåº”è¯¥æ˜¯

**p -> div -> body -> html -> document**

### äº‹ä»¶æ•è·

ç½‘æ™¯æå‡ºå¦ä¸€ç§äº‹ä»¶æµåä¸º**äº‹ä»¶æ•è·**(event capturing)ã€‚ä¸äº‹ä»¶å†’æ³¡ç›¸åï¼Œäº‹ä»¶ä¼šä»æœ€å¤–å±‚å¼€å§‹å‘ç”Ÿï¼Œç›´åˆ°æœ€å…·ä½“çš„å…ƒç´ ã€‚

ä¸Šé¢çš„ä¾‹å­åœ¨äº‹ä»¶æ•è·çš„æ¦‚å¿µä¸‹å‘ç”Ÿclickäº‹ä»¶çš„é¡ºåºåº”è¯¥æ˜¯

**document -> html -> body -> div -> p**

### äº‹ä»¶å†’æ³¡å’Œäº‹ä»¶æ•è·è¿‡ç¨‹å›¾

![img](https://user-gold-cdn.xitu.io/2019/4/16/16a2654b0dd928ef?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

1-5æ˜¯æ•è·è¿‡ç¨‹ï¼Œ5-6æ˜¯ç›®æ ‡é˜¶æ®µï¼Œ6-10æ˜¯å†’æ³¡é˜¶æ®µ



## äº‹ä»¶ä»£ç†

åœ¨å®é™…çš„å¼€å‘å½“ä¸­ï¼Œåˆ©ç”¨äº‹ä»¶æµçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ç§å«åšäº‹ä»¶ä»£ç†çš„æ–¹æ³•ã€‚

```html
<ul class="color_list">        
    <li>red</li>        
    <li>orange</li>        
    <li>yellow</li>        
    <li>green</li>        
    <li>blue</li>        
    <li>purple</li>    
</ul>
<div class="box"></div>

.color_list{            
    display: flex;            
    display: -webkit-flex;        
}        
.color_list li{            
    width: 100px;            
    height: 100px;            
    list-style: none;            
    text-align: center;            
    line-height: 100px;        
}
//æ¯ä¸ªliåŠ ä¸Šå¯¹åº”çš„é¢œè‰²ï¼Œæ­¤å¤„çœç•¥
.box{            
    width: 600px;            
    height: 150px;            
    background-color: #cccccc;            
    line-height: 150px;            
    text-align: center;        
}
```

![img](https://user-gold-cdn.xitu.io/2019/4/16/16a264146329fa93?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

æˆ‘ä»¬æƒ³è¦åœ¨ç‚¹å‡»æ¯ä¸ª li æ ‡ç­¾æ—¶ï¼Œè¾“å‡ºliå½“ä¸­çš„é¢œè‰²`ï¼ˆinnerHTMLï¼‰` ã€‚å¸¸è§„åšæ³•æ˜¯éå†æ¯ä¸ª li ,ç„¶ååœ¨æ¯ä¸ª li ä¸Šç»‘å®šä¸€ä¸ªç‚¹å‡»äº‹ä»¶ï¼š

```js
var color_list=document.querySelector(".color_list");            
var colors=color_list.getElementsByTagName("li");            
var box=document.querySelector(".box");            
for(var n=0;n<colors.length;n++){                
    colors[n].addEventListener("click",function(){                    
        console.log(this.innerHTML)                    
        box.innerHTML="è¯¥é¢œè‰²ä¸º "+this.innerHTML;                
    })            
}
```

è¿™ç§åšæ³•åœ¨ li è¾ƒå°‘çš„æ—¶å€™å¯ä»¥ä½¿ç”¨ï¼Œä½†å¦‚æœæœ‰ä¸€ä¸‡ä¸ª li ï¼Œé‚£å°±ä¼šå¯¼è‡´æ€§èƒ½é™ä½ï¼ˆå°‘äº†éå†æ‰€æœ‰ li èŠ‚ç‚¹çš„æ“ä½œï¼Œæ€§èƒ½ä¸Šè‚¯å®šæ›´åŠ ä¼˜åŒ–ï¼‰ã€‚

è¿™æ—¶å°±éœ€è¦äº‹ä»¶ä»£ç†å‡ºåœºäº†ï¼Œåˆ©ç”¨äº‹ä»¶æµçš„ç‰¹æ€§ï¼Œæˆ‘ä»¬åªç»‘å®šä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ä¹Ÿå¯ä»¥å®Œæˆï¼š

```js
function colorChange(e){                
    var e=e||window.event;//å…¼å®¹æ€§çš„å¤„ç†         
    if(e.target.nodeName.toLowerCase()==="li"){                    
        box.innerHTML="è¯¥é¢œè‰²ä¸º "+e.target.innerHTML;                
    }                            
}            
color_list.addEventListener("click",colorChange,false)
```



- e.target     å½“å‰ç‚¹å‡»çš„å…ƒç´ 

- e.currentTarget   å½“å‰äº‹ä»¶ç»‘å®šçš„å…ƒç´ 



**ç”±äºäº‹ä»¶å†’æ³¡æœºåˆ¶ï¼Œç‚¹å‡»äº† li åä¼šå†’æ³¡åˆ° ul ï¼Œæ­¤æ—¶å°±ä¼šè§¦å‘ç»‘å®šåœ¨ ul ä¸Šçš„ç‚¹å‡»äº‹ä»¶ï¼Œå†åˆ©ç”¨ target æ‰¾åˆ°äº‹ä»¶å®é™…å‘ç”Ÿçš„å…ƒç´ ï¼Œå°±å¯ä»¥è¾¾åˆ°é¢„æœŸçš„æ•ˆæœã€‚**

**ä½¿ç”¨äº‹ä»¶ä»£ç†çš„å¥½å¤„ä¸ä»…åœ¨äºå°†å¤šä¸ªäº‹ä»¶å¤„ç†å‡½æ•°å‡ä¸ºä¸€ä¸ªï¼Œè€Œä¸”å¯¹äºä¸åŒçš„å…ƒç´ å¯ä»¥æœ‰ä¸åŒçš„å¤„ç†æ–¹æ³•ã€‚**

**å‡å¦‚ä¸Šè¿°åˆ—è¡¨å…ƒç´ å½“ä¸­æ·»åŠ äº†å…¶ä»–çš„å…ƒç´ èŠ‚ç‚¹ï¼ˆå¦‚ï¼šaã€spanç­‰ï¼‰ï¼Œæˆ‘ä»¬ä¸å¿…å†ä¸€æ¬¡å¾ªç¯ç»™æ¯ä¸€ä¸ªå…ƒç´ ç»‘å®šäº‹ä»¶ï¼Œç›´æ¥ä¿®æ”¹äº‹ä»¶ä»£ç†çš„äº‹ä»¶å¤„ç†å‡½æ•°å³å¯ã€‚**

**ï¼ˆ1ï¼‰toLowerCase()** æ–¹æ³•ç”¨äºæŠŠå­—ç¬¦ä¸²è½¬æ¢ä¸ºå°å†™ã€‚

- **è¯­æ³•ï¼š**stringObject.toLowerCase()

- **è¿”å›å€¼ï¼š**ä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²ï¼Œåœ¨å…¶ä¸­ stringObject çš„æ‰€æœ‰å¤§å†™å­—ç¬¦å…¨éƒ¨è¢«è½¬æ¢ä¸ºäº†å°å†™å­—ç¬¦

**ï¼ˆ2ï¼‰nodeName** å±æ€§æŒ‡å®šèŠ‚ç‚¹çš„èŠ‚ç‚¹åç§°ã€‚å¦‚æœèŠ‚ç‚¹æ˜¯å…ƒç´ èŠ‚ç‚¹ï¼Œåˆ™ nodeName å±æ€§è¿”å›æ ‡ç­¾åã€‚å¦‚æœèŠ‚ç‚¹æ˜¯å±æ€§èŠ‚ç‚¹ï¼Œåˆ™ nodeName å±æ€§è¿”å›å±æ€§çš„åç§°ã€‚å¯¹äºå…¶ä»–èŠ‚ç‚¹ç±»å‹ï¼ŒnodeName å±æ€§è¿”å›ä¸åŒèŠ‚ç‚¹ç±»å‹çš„ä¸åŒåç§°ã€‚

**æ‰€æœ‰ä¸»æµæµè§ˆå™¨å‡æ”¯æŒ nodeName å±æ€§**

### å†’æ³¡è¿˜æ˜¯æ•è·ï¼Ÿ

å¯¹äºäº‹ä»¶ä»£ç†æ¥è¯´ï¼Œåœ¨äº‹ä»¶æ•è·æˆ–è€…äº‹ä»¶å†’æ³¡é˜¶æ®µå¤„ç†å¹¶æ²¡æœ‰æ˜æ˜¾çš„ä¼˜åŠ£ä¹‹åˆ†ï¼Œä½†æ˜¯ç”±äºäº‹ä»¶å†’æ³¡çš„äº‹ä»¶æµæ¨¡å‹è¢«æ‰€æœ‰ä¸»æµçš„æµè§ˆå™¨å…¼å®¹ï¼Œä»å…¼å®¹æ€§è§’åº¦æ¥è¯´è¿˜æ˜¯å»ºè®®å¤§å®¶ä½¿ç”¨äº‹ä»¶å†’æ³¡æ¨¡å‹ã€‚

### IEæµè§ˆå™¨å…¼å®¹

IEæµè§ˆå™¨å¯¹addEventListenerå…¼å®¹æ€§å¹¶ä¸ç®—å¤ªå¥½ï¼Œåªæœ‰IE9ä»¥ä¸Šå¯ä»¥ä½¿ç”¨ã€‚

![img](https://user-gold-cdn.xitu.io/2019/4/16/16a2645694fc3e3c?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

è¦å…¼å®¹æ—§ç‰ˆæœ¬çš„IEæµè§ˆå™¨ï¼Œå¯ä»¥ä½¿ç”¨IEçš„attachEventå‡½æ•°

> object.attachEvent(event, function)

ä¸¤ä¸ªå‚æ•°ä¸addEventListenerç›¸ä¼¼ï¼Œåˆ†åˆ«æ˜¯äº‹ä»¶å’Œå¤„ç†å‡½æ•°ï¼Œé»˜è®¤æ˜¯äº‹ä»¶å†’æ³¡é˜¶æ®µè°ƒç”¨å¤„ç†å‡½æ•°ï¼Œè¦æ³¨æ„çš„æ˜¯ï¼Œå†™äº‹ä»¶åæ—¶å€™è¦åŠ ä¸Š"on"å‰ç¼€ï¼ˆ"onload"ã€"onclick"ç­‰ï¼‰ã€‚

### é˜»æ­¢äº‹ä»¶å†’æ³¡

**1. ç»™å­çº§åŠ  event.stopPropagation( )**

```js
$("#div1").mousedown(function(e){
    var e=event||window.event;
    event.stopPropagation();
});
```

**2. åœ¨äº‹ä»¶å¤„ç†å‡½æ•°ä¸­è¿”å› false**

```js
$("#div1").mousedown(function(event){
    var e=e||window.event;
    return false;
});
```

ä½†æ˜¯è¿™ä¸¤ç§æ–¹å¼æ˜¯æœ‰åŒºåˆ«çš„ã€‚`return false` ä¸ä»…é˜»æ­¢äº†äº‹ä»¶å¾€ä¸Šå†’æ³¡ï¼Œè€Œä¸”é˜»æ­¢äº†äº‹ä»¶æœ¬èº«(é»˜è®¤äº‹ä»¶)ã€‚`event.stopPropagation()`åˆ™åªé˜»æ­¢äº‹ä»¶å¾€ä¸Šå†’æ³¡ï¼Œä¸é˜»æ­¢äº‹ä»¶æœ¬èº«ã€‚

**3. event.target==event.currentTargetï¼Œè®©è§¦å‘äº‹ä»¶çš„å…ƒç´ ç­‰äºç»‘å®šäº‹ä»¶çš„å…ƒç´ ï¼Œä¹Ÿå¯ä»¥é˜»æ­¢äº‹ä»¶å†’æ³¡ï¼›**

![img](https://user-gold-cdn.xitu.io/2019/5/7/16a8f8e3813c6b19?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)![img](https://user-gold-cdn.xitu.io/2019/5/7/16a8f8e60ebf3c9e?imageView2/0/w/1280/h/960/format/webp/ignore-error/1)

### é˜»æ­¢é»˜è®¤äº‹ä»¶

ï¼ˆ1ï¼‰event.preventDefault( )

ï¼ˆ2ï¼‰return false



## äº‹ä»¶å¤„ç†ç¨‹åº

ä¸ºäº†å“åº”ç”¨æˆ·æˆ–è€…æµè§ˆå™¨æ‰§è¡Œçš„æŸç§åŠ¨ä½œï¼ˆ `click` ã€ `load` ã€ `mouseover` ... ï¼‰è€Œè°ƒç”¨çš„ on å¼€å¤´çš„å‡½æ•°è¢«ç§°ä¸ºäº‹ä»¶å¤„ç†ç¨‹åºï¼ˆäº‹ä»¶ç›‘å¬å™¨ï¼‰ã€‚

### HTML äº‹ä»¶å¤„ç†ç¨‹åº

ç‰¹å®šçš„å…ƒç´ æ”¯æŒçš„æ¯ä¸ªäº‹ä»¶éƒ½å¯ä»¥ç”¨ HTML å±æ€§çš„å½¢å¼ä½¿ç”¨äº‹ä»¶å¤„ç†ç¨‹åºã€‚å…¶å®ä¹Ÿå°±æ˜¯æˆ‘ä»¬æœ€å¸¸ä½¿ç”¨çš„æ–¹å¼ï¼Œå¦‚ä¸‹ä»£ç ï¼Œ `onclick` å±æ€§çš„å€¼æ˜¯ JS ä»£ç æˆ–è€…å…¶ä»–çš„è°ƒç”¨æ–¹æ³•ã€‚

ä½¿ç”¨äº‹ä»¶ç›‘å¬å™¨ï¼Œæµè§ˆå™¨ä¼šå…ˆåˆ›å»ºä¸€ä¸ªå‡½æ•°æ¥å°è£…å±æ€§çš„å€¼ï¼Œè¿™ä¸ªå‡½æ•°æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å±€éƒ¨å˜é‡ï¼š`event` ç”¨æ¥ä¿å­˜ `event` å¯¹è±¡ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ `this` æŒ‡å‘äº‹ä»¶çš„ç›®æ ‡å…ƒç´ ã€‚

```html
<input type="button" value="click me" onclick="console.log('click')" />
```

### DOM0 äº‹ä»¶å¤„ç†ç¨‹åº

åœ¨ JavaScript ä¸­åˆ›å»ºäº‹ä»¶ç›‘å¬å™¨çš„ä¼ ç»Ÿæ–¹å¼æ˜¯æŠŠä¸€ä¸ªå‡½æ•°èµ‹å€¼ç»™ DOM å…ƒç´ ã€‚å…¼å®¹æ€§æœ€å¥½ï¼Œæ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ”¯æŒæ­¤æ–¹æ³•ã€‚

æ¯ä¸ªå…ƒç´ ï¼ˆåŒ…æ‹¬ window å’Œ documentï¼‰éƒ½æœ‰äº‹ä»¶å¤„ç†ç¨‹åºçš„å±æ€§ï¼ˆä¸€èˆ¬éƒ½ onxxxxï¼‰ï¼Œè¿™ä¸ªå±æ€§çš„å€¼ä¸ºä¸€ä¸ªå‡½æ•°ã€‚

```javascript
const btn = document.getElementById("myBtn");
btn.onclick = function(){
  console.log('Clicked')
}
```

è¿™æ ·ä½¿ç”¨ **DOM0 äº‹ä»¶å¤„ç†æ˜¯å‘ç”Ÿåœ¨ç¨‹åºèµ‹å€¼æ—¶æ³¨å†Œåœ¨äº‹ä»¶æµçš„å†’æ³¡é˜¶æ®µ**çš„ã€‚

æ‰€èµ‹å€¼çš„å‡½æ•°è¢«è§†ä¸ºå…ƒç´ çš„æ–¹æ³•ï¼Œåœ¨å…ƒç´ çš„ä½œç”¨åŸŸä¸­è¿è¡Œï¼Œthis æŒ‡å‘è¯¥å…ƒç´ æœ¬èº«ã€‚åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­é€šè¿‡ this å¯ä»¥è®¿é—®å…ƒç´ çš„ä»»ä½•å±æ€§å’Œæ–¹æ³•ã€‚

å°†äº‹ä»¶å¤„ç†ç¨‹åºå±æ€§è®¾ç½®ä¸º nullï¼Œå³å¯ç§»é™¤é€šè¿‡ DOM0 æ–¹å¼æ·»åŠ çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚

```javascript
btn.onclick = null;
```

å¦‚æœæœ‰å¤šä¸ª DOM0 äº‹ä»¶å¤„ç†ç¨‹åºçš„è¯ï¼Œåé¢çš„æ˜¯ä¼šæŠŠå‰é¢çš„ç»™è¦†ç›–æ‰ã€‚åªæœ‰æ‰§è¡Œæœ€åä¸€ä¸ªè°ƒç”¨çš„ç»“æœã€‚

### DOM2 äº‹ä»¶å¤„ç†ç¨‹åº

æˆ‘ä»¬ä¹Ÿå¯ä»¥é€šè¿‡åœ¨æ‰€æœ‰çš„ DOM èŠ‚ç‚¹ä¸Šé€šè¿‡ `addEventListener()` å’Œ `removeEventLinstener()` æ¥æ·»åŠ å’Œç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åºã€‚

### addEventListener 

DOM2çº§äº‹ä»¶ä¸­è§„å®šçš„äº‹ä»¶æµåŒæ—¶æ”¯æŒäº†äº‹ä»¶æ•è·é˜¶æ®µå’Œäº‹ä»¶å†’æ³¡é˜¶æ®µï¼Œè€Œä½œä¸ºå¼€å‘è€…ï¼Œæˆ‘ä»¬å¯ä»¥é€‰æ‹©äº‹ä»¶å¤„ç†å‡½æ•°åœ¨å“ªä¸€ä¸ªé˜¶æ®µè¢«è°ƒç”¨ã€‚

addEventListeneræ–¹æ³•ç”¨æ¥ä¸ºä¸€ä¸ªç‰¹å®šçš„å…ƒç´ ç»‘å®šä¸€ä¸ªäº‹ä»¶å¤„ç†å‡½æ•°ï¼Œæ˜¯JavaScriptä¸­çš„å¸¸ç”¨æ–¹æ³•ã€‚addEventListeneræœ‰ä¸‰ä¸ªå‚æ•°ï¼š

```js
 element.addEventListener(event, function, useCapture | option)
```

| å‚æ•°       | æè¿°                                             |                                                              |
| ---------- | ------------------------------------------------ | ------------------------------------------------------------ |
| event      | å¿…é¡»ã€‚å­—ç¬¦ä¸²ï¼ŒæŒ‡å®šäº‹ä»¶å                         | **æç¤ºï¼š** æ‰€æœ‰ HTML DOM äº‹ä»¶ï¼Œå¯ä»¥æŸ¥çœ‹æˆ‘ä»¬å®Œæ•´çš„ [HTML DOM Event å¯¹è±¡å‚è€ƒæ‰‹å†Œ](http://www.runoob.com/jsref/dom-obj-event.html)ã€‚ |
| function   | å¿…é¡»ã€‚æŒ‡å®šè¦äº‹ä»¶è§¦å‘æ—¶æ‰§è¡Œçš„å‡½æ•°                 | å½“äº‹ä»¶å¯¹è±¡ä¼šä½œä¸ºç¬¬ä¸€ä¸ªå‚æ•°ä¼ å…¥å‡½æ•°ã€‚ äº‹ä»¶å¯¹è±¡çš„ç±»å‹å–å†³äºç‰¹å®šçš„äº‹ä»¶ã€‚ä¾‹å¦‚ï¼Œ "click" äº‹ä»¶å±äº MouseEvent(é¼ æ ‡äº‹ä»¶) å¯¹è±¡ã€‚ |
| useCapture | å¯é€‰ã€‚å¸ƒå°”å€¼ï¼ŒæŒ‡å®šäº‹ä»¶æ˜¯å¦åœ¨æ•è·æˆ–å†’æ³¡é˜¶æ®µæ‰§è¡Œã€‚ | **true** - äº‹ä»¶å¥æŸ„åœ¨æ•è·é˜¶æ®µæ‰§è¡Œï¼ˆå³åœ¨äº‹ä»¶æ•è·é˜¶æ®µè°ƒç”¨å¤„ç†å‡½æ•°ï¼‰<br>**false **- é»˜è®¤ã€‚äº‹ä»¶å¥æŸ„åœ¨å†’æ³¡é˜¶æ®µæ‰§è¡Œï¼ˆå³è¡¨ç¤ºåœ¨äº‹ä»¶å†’æ³¡çš„é˜¶æ®µè°ƒç”¨äº‹ä»¶å¤„ç†å‡½æ•°ï¼‰ |
| option     | ä¸€ä¸ªæŒ‡å®šæœ‰å…³ `listener `å±æ€§çš„å¯é€‰å‚æ•°**å¯¹è±¡**ã€‚ | **capture**:  Booleanï¼Œè¡¨ç¤º listener ä¼šåœ¨è¯¥ç±»å‹çš„äº‹ä»¶æ•è·é˜¶æ®µä¼ æ’­åˆ°è¯¥ EventTarget æ—¶è§¦å‘ã€‚<br/>**once**:  Booleanï¼Œè¡¨ç¤º listener åœ¨æ·»åŠ ä¹‹åæœ€å¤šåªè°ƒç”¨ä¸€æ¬¡ã€‚å¦‚æœæ˜¯ trueï¼Œ listener ä¼šåœ¨å…¶è¢«è°ƒç”¨ä¹‹åè‡ªåŠ¨ç§»é™¤ã€‚<br/>**passive**: Booleanï¼Œè®¾ç½®ä¸ºtrueæ—¶ï¼Œè¡¨ç¤º listener æ°¸è¿œä¸ä¼šè°ƒç”¨ preventDefault()ã€‚å¦‚æœ listener ä»ç„¶è°ƒç”¨äº†è¿™ä¸ªå‡½æ•°ï¼Œå®¢æˆ·ç«¯å°†ä¼šå¿½ç•¥å®ƒå¹¶æŠ›å‡ºä¸€ä¸ªæ§åˆ¶å°è­¦å‘Šã€‚ |

ç®€å•çš„è¯´ï¼Œæˆ‘ä¸ªäººçš„ç†è§£æ˜¯ useCapture å‚æ•°æŒ‡å®šäº†è¯¥äº‹ä»¶å¤„ç†ç¨‹åºè§¦å‘çš„â€œæ—¶æœºâ€ ï¼šæ˜¯åœ¨äº‹ä»¶æµçš„æ•è·é˜¶æ®µè¿˜æ˜¯å†’æ³¡é˜¶æ®µã€‚**ä½†æ˜¯ï¼Œæ— è®ºæœ€åä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºä»€ä¹ˆï¼Œéƒ½ä¸ä¼šé˜»ç¢äº‹ä»¶æµçš„ä¼ æ’­ã€‚**

ğŸŒ°ï¼šä¸€ä¸ªé¡µé¢ä¸Šæœ‰ä¸€ä¸ª buttonï¼Œbutton ä¸Šæ·»åŠ äº†ä¸ª click äº‹ä»¶ï¼Œç„¶åæˆ‘ä»¬ç»™ body ä¸Šä¹Ÿæ–°å¢ä¸€ä¸ª click äº‹ä»¶ï¼Œç„¶ååˆ†åˆ«å°† useCapture è®¾ç½®ä¸º true å’Œ falseï¼Œè§‚å¯Ÿä¸‹ä¼šå‘ç”Ÿä»€ä¹ˆ

```javascript
  btn.addEventListener("click", (e) => {
    console.log('btn click capture ')
  }, true);

  btn.addEventListener("click", (e) => {
    console.log('btn click bubble ')
  });

  body.addEventListener("click", (e) => {
    console.log('body click capture')
  }, true);

  body.addEventListener("click", (e) => {
    console.log('body click bubble')
  });

// body click capture
// btn click capture 
// btn click bubble
// body click bubble
```

é€šè¿‡ log çš„ç»“æœæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼ŒuseCaptureï¼ˆ option ä¸­çš„ capture ä¹Ÿæ˜¯ä¸€æ ·ï¼‰**åªæ˜¯æ§åˆ¶è¯¥äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯æ·»åŠ åœ¨äº‹ä»¶æµçš„æ•è·é˜¶æ®µè¿˜æ˜¯å†’æ³¡é˜¶æ®µï¼Œå¯¹äº‹ä»¶çš„ä¼ æ’­æ˜¯æ²¡æœ‰å½±å“çš„ï¼**

>  æ¥å£çš„ `**preventDefault()**`æ–¹æ³•ï¼Œå‘Šè¯‰[user agent](https://developer.mozilla.org/zh-CN/docs/Glossary/User_agent)ï¼šå¦‚æœæ­¤äº‹ä»¶æ²¡æœ‰è¢«æ˜¾å¼å¤„ç†ï¼Œå®ƒé»˜è®¤çš„åŠ¨ä½œä¹Ÿä¸åº”è¯¥ç…§å¸¸æ‰§è¡Œã€‚
>
> æ­¤äº‹ä»¶è¿˜æ˜¯ç»§ç»­ä¼ æ’­ï¼Œé™¤éç¢°åˆ°äº‹ä»¶ä¾¦å¬å™¨è°ƒç”¨[`stopPropagation()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/stopPropagation) æˆ–[`stopImmediatePropagation()`](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/stopImmediatePropagation)ï¼Œæ‰åœæ­¢ä¼ æ’­ã€‚

ä»¥ä¸Šä»£ç ä¸ºä¼šåœ¨äº‹ä»¶æµçš„æŒ‡å®šé˜¶æ®µè§¦å‘ click çš„äº‹ä»¶å¤„ç†ç¨‹åºã€‚

ä¸ DOM0 ç±»ä¼¼ï¼Œè¿™ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºåŒæ ·è¢«é™„åŠ åœ¨å…ƒç´ çš„ä½œç”¨åŸŸä¸­è¿è¡Œï¼Œæ‰€ä»¥ï¼Œäº‹ä»¶å¤„ç†å‡½æ•°ä¸­çš„ this æŒ‡å‘çš„æ˜¯è¯¥å…ƒç´ ã€‚

DOM2 äº‹ä»¶å¤„ç†ç¨‹åºçš„ä¸€ä¸ªä¼˜ç‚¹æ˜¯å¯ä»¥ç»™ä¸€ä¸ªå…ƒç´ æ·»åŠ å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¹¶æŒ‰æ·»åŠ çš„é¡ºåºè§¦å‘ã€‚

ä½¿ç”¨`addEventListener()` æ·»åŠ çš„äº‹ä»¶å¤„ç†ç¨‹åºåªèƒ½ä½¿ç”¨ `removeEventLinstener()`ç§»é™¤ï¼ˆä¸‰ä¸ªå‚æ•°å‡ä¸€è‡´æ‰å¯ä»¥ï¼‰

**ä½¿ç”¨åŒ¿åå‡½æ•°æ·»åŠ çš„äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯ä¸èƒ½è¢«ç§»é™¤çš„ã€‚**

### IE äº‹ä»¶å¤„ç†ç¨‹åº

IE å®ç°äº‹ä»¶å¤„ç†ç¨‹åºçš„æ–¹æ³•æ˜¯ï¼š `attachEvent()` å’Œ `detachEvent()` è¿™ä¸¤ä¸ªæ–¹æ³•æ¥æ”¶ä¸¤ä¸ªåŒæ ·çš„å‚æ•°ï¼šäº‹ä»¶å¤„ç†ç¨‹åºçš„åç§°ï¼ˆ eg: `onclick` ï¼‰å’Œäº‹ä»¶å¤„ç†å‡½æ•°ã€‚å› ä¸º IE8 åŠæ›´æ—©çš„ç‰ˆæœ¬åªæ”¯æŒäº‹ä»¶å†’æ³¡ï¼Œæ‰€ä»¥ä½¿ç”¨ `attachEvent()` æ·»åŠ çš„äº‹ä»¶å¤„ç†ç¨‹åºæ˜¯æ·»åŠ åœ¨**å†’æ³¡é˜¶æ®µ**ã€‚

```javascript
const btn = document.getElementById("myBtn");

btn.attachEvent("onclick", function(){
  console.log("Clicked");
})
```

IE äº‹ä»¶å¤„ç†ç¨‹åºå’Œ DOM2 äº‹ä»¶å¤„ç†ç¨‹åºæœ‰ä¸¤ä¸ªä¸ä¸€æ ·çš„åœ°æ–¹

1. ä½œç”¨åŸŸï¼š`attachEvent()`æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸­è¿è¡Œçš„ï¼Œæ‰€ä»¥ `attachEvent()` ä¸­çš„å‡½æ•°ä¸­çš„ `this` æ˜¯ `window`ï¼›
2. æ‰§è¡Œé¡ºåºï¼šIE äº‹ä»¶å¤„ç†ç¨‹åºçš„æ‰§è¡Œé¡ºåºæ˜¯å’Œæ·»åŠ é¡ºåºç›¸åçš„ã€‚

### å››ç§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«

|                   | ä½¿ç”¨æ–¹æ³•                                                     | ç§»é™¤æ–¹æ³•                  | å¤‡æ³¨                                                         |
| ----------------- | ------------------------------------------------------------ | ------------------------- | ------------------------------------------------------------ |
| HTML äº‹ä»¶å¤„ç†ç¨‹åº | ç”¨ HTML å±æ€§çš„å½¢å¼ä½¿ç”¨äº‹ä»¶å¤„ç†ç¨‹åº `onclick="console.log('click')"` | åŒ DOM0 äº‹ä»¶å¤„ç†ç¨‹åº æ–¹å¼ | `event` å±€éƒ¨å˜é‡ç”¨æ¥ä¿å­˜ `event` å¯¹è±¡ï¼Œå‡½æ•°ä¸­çš„ `this` æŒ‡å‘äº‹ä»¶çš„ç›®æ ‡å…ƒç´  |
| DOM0 äº‹ä»¶å¤„ç†ç¨‹åº | æŠŠä¸€ä¸ªå‡½æ•°èµ‹å€¼ç»™ DOM å…ƒç´   `btn.onclick = function(){}`      | `btn.onclick = null`      | 1. å‘ç”Ÿåœ¨å†’æ³¡é˜¶æ®µ<br>2. this æŒ‡å‘å…ƒç´ æœ¬èº«                    |
| DOM2 äº‹ä»¶å¤„ç†ç¨‹åº | `addEventListener()`                                         | `removeEventLinstener()`  | 1. æ¥æ”¶ 3 ä¸ªå‚æ•°ï¼šäº‹ä»¶åã€äº‹ä»¶å¤„ç†å‡½æ•° å’Œ options æˆ–ä¸€ä¸ªå¸ƒå°”å€¼( `true` è¡¨ç¤ºåœ¨æ•è·é˜¶æ®µè°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åºï¼Œ`false`ï¼ˆé»˜è®¤å€¼ï¼‰è¡¨ç¤ºåœ¨å†’æ³¡é˜¶æ®µè°ƒç”¨äº‹ä»¶å¤„ç†ç¨‹åº)<br>2. å¯ä»¥ç»™ä¸€ä¸ªå…ƒç´ æ·»åŠ å¤šä¸ªäº‹ä»¶å¤„ç†ç¨‹åºï¼Œå¹¶æŒ‰æ·»åŠ çš„é¡ºåºè§¦å‘ã€‚<br>3. ä½¿ç”¨ `addEventListener()` æ·»åŠ çš„äº‹ä»¶å¤„ç†ç¨‹åºåªèƒ½ä½¿ç”¨ `removeEventLinstener()` ç§»é™¤ï¼ˆä¸‰ä¸ªå‚æ•°ä¸€è‡´æ‰å¯ä»¥ï¼‰ |
| IE äº‹ä»¶å¤„ç†ç¨‹åº   | `attachEvent()`                                              | `detachEvent()`           | 1.  IE8 åŠæ›´æ—©çš„ç‰ˆæœ¬åªæ”¯æŒäº‹ä»¶å†’æ³¡  <br>2. attachEvent()æ˜¯åœ¨å…¨å±€ä½œç”¨åŸŸä¸­è¿è¡Œçš„, `this` æ˜¯ `window`<br>3. IE äº‹ä»¶å¤„ç†ç¨‹åºçš„æ‰§è¡Œé¡ºåºæ˜¯å’Œæ·»åŠ é¡ºåºç›¸åçš„ |



## äº‹ä»¶å¯¹è±¡

åœ¨ DOM ä¸­å‘ç”Ÿäº‹ä»¶æ—¶ï¼Œæ‰€æœ‰çš„ç›¸å…³ä¿¡æ¯éƒ½ä¼šè¢«æ”¶é›†åœ¨ä¸€ä¸ªåä¸º `event` çš„å¯¹è±¡ä¸­ã€‚è¿™ä¸ªå¯¹è±¡åŒ…å«äº†ä¸€äº›åŸºæœ¬ä¿¡æ¯ï¼šè§¦å‘äº‹ä»¶çš„å…ƒç´ ã€äº‹ä»¶çš„ç±»å‹ã€ä»¥åŠä¸€äº›ä¸ç‰¹å®šäº‹ä»¶ç›¸å…³çš„å…¶ä»–æ•°æ®ï¼ˆæ¯”å¦‚å’Œé¼ æ ‡äº‹ä»¶ç›¸å…³çš„é¼ æ ‡çš„ä½ç½®ä¿¡æ¯ï¼‰æ‰€æœ‰çš„æµè§ˆå™¨éƒ½æ˜¯æ”¯æŒè¿™ä¸ª `event` å¯¹è±¡çš„ã€‚

```javascript
btn.onclick = function(event){
  console.log(event.type)     // click
}

btn.addEventListener("click", () => {
  console.log(event.type);    // click
}, false);
```

### DOM äº‹ä»¶å¯¹è±¡ event

åœ¨äº‹ä»¶å¤„ç†å‡½æ•°çš„å†…éƒ¨ï¼Œ`this` å¯¹è±¡å§‹ç»ˆç­‰äº `currentTarget` (å› ä¸º this æ˜¯æŒ‡å‘è°ƒç”¨çš„å¯¹è±¡çš„)ã€‚

`target` æ˜¯äº‹ä»¶è§¦å‘çš„å®é™…ç›®æ ‡ã€‚ï¼ˆäº‹ä»¶å†’æ³¡é˜¶æ®µå¯èƒ½å‡ºç° `target` å’Œ `currentTarget` ä¸ç›¸ç­‰çš„æƒ…å†µã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
</head>
<body>
  <div id="div"> Click me</div>
</body>
<script>
  var div = document.querySelector('#div');
  div.addEventListener('click', function(e){
    console.log('div click', e.currentTarget === this);    // true 
    console.log('div click', e.target === this);           // true
  })

  var body = document.querySelector('body');
  body.addEventListener('click', function(e){
    console.log('body click', e.currentTarget === this);   // true
    console.log('body click', e.target === this);          // false
  })
</script>
</html>
```

#### preventDefault()

`preventDefault()` æ–¹æ³•ç”¨äºé˜»æ­¢äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºï¼ˆæ¯”å¦‚ï¼Œa æ ‡ç­¾æœ‰è·³è½¬åˆ° href é“¾æ¥çš„é»˜è®¤è¡Œä¸ºï¼Œä½¿ç”¨ `preventDefault()` å¯ä»¥é˜»æ­¢è¿™ç§å¯¼èˆªè¡Œä¸ºï¼‰

**preventDefault() é˜»æ­¢çš„å¿…éœ€æ˜¯å¯ cancelable çš„å…ƒç´ ** 

> `Event` äº‹ä»¶çš„ `preventDefault` æ­£å¸¸è§„èŒƒæ“ä½œæ˜¯ä¼˜å…ˆcheckæ˜¯å¦å¯ä»¥ `cancelable` ï¼ˆ[MDN check](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/cancelable#ç¤ºä¾‹)ï¼‰ï¼Œå¦‚æœ `cancelable=false` ï¼Œé‚£å°±ä¸èƒ½è¢«é˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œè¿™ä¸ªä»£ç å°±ä¸èƒ½èµ·ä½œç”¨ã€‚
>
> ï¼ˆ[å‚è€ƒMDNï¼š](https://developer.mozilla.org/zh-CN/docs/Web/API/Event/cancelable)å¤§éƒ¨åˆ†ç”±ç”¨æˆ·ä¸é¡µé¢äº¤äº’äº§ç”Ÿçš„åŸç”Ÿæµè§ˆå™¨äº‹ä»¶éƒ½å¯ä»¥è¢«å–æ¶ˆã€‚å–æ¶ˆ[click](https://developer.mozilla.org/zh-CN/docs/Web/Reference/Events/click)ï¼Œ[scroll](https://developer.mozilla.org/zh-CN/docs/Web/Reference/Events/scroll)æˆ– [beforeunload](https://developer.mozilla.org/zh-CN/docs/Web/Reference/Events/beforeunload)äº‹ä»¶å°†åˆ†åˆ«é˜»æ­¢ç”¨æˆ·ç‚¹å‡»æŸäº›å…ƒç´ ï¼Œæ»šåŠ¨é¡µé¢æˆ–è·³ç¦»é¡µé¢ã€‚ï¼‰

```javascript
const link = document.getElementById("myLink");

link.onclick = function(event){
  event.preventDefault();
}
```

#### stopPropagation()

`stopPropagation()` æ–¹æ³•ç”¨äºç«‹å³é˜»æ­¢äº‹ä»¶æµåœ¨ DOM ä¸­çš„ä¼ æ’­ï¼Œå–æ¶ˆåç»­çš„äº‹ä»¶æ•è·æˆ–å†’æ³¡ã€‚æ¯”å¦‚

```javascript
var div = document.querySelector('#div');

div.addEventListener("click", (e) => {
  console.log("clicked");
  e.stopPropagation()
}, false);

document.body.addEventListener("click", () => {
  console.log("body clicked");
}, false);
```

å¦‚æœä¸è°ƒç”¨ `stopPropagation()` é‚£ä¹ˆç‚¹å‡» `div` ä¼šæœ‰ä¸¤ä¸ª log è®°å½•ã€‚å¦‚æœåŠ ä¸Šçš„è¯ï¼Œclick äº‹ä»¶å°±ä¸ä¼šä¼ æ’­åˆ° body ä¸Šï¼Œåªä¼šæœ‰ä¸€ä¸ª log è®°å½•ï¼ˆ `clicked` ï¼‰ã€‚

**ä½†æ˜¯éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰çš„äº‹ä»¶éƒ½ä¼šå†’æ³¡**ï¼æ¯”å¦‚æŸäº› **scroll äº‹ä»¶å°±æ˜¯ä¸ä¼šå†’æ³¡çš„**ã€‚

##### scrolläº‹ä»¶å¯¹äºæ™®é€šElementå…ƒç´ æ˜¯ä¸å†’æ³¡çš„

æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åœ¨ MDN ä¸Šå…³äº scroll event çš„æè¿° ![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2e2f6df491ae4bcdbd30160461f8d0d9~tplv-k3u1fbpfcp-zoom-1.image)

> **Bubbles Not on elements, but bubbles to the default view when fired on the document** 
>
> å†’æ³¡: `element`çš„`scroll`äº‹ä»¶**ä¸å†’æ³¡**, ä½†æ˜¯`document`çš„`defaultView`çš„`scroll`äº‹ä»¶å†’æ³¡

ä¹Ÿå°±æ˜¯è¯´å¦‚æœè§¦å‘ scroll çš„å…ƒç´ æ˜¯ä¸€ä¸ª `element` çš„è¯ï¼Œé‚£ä¹ˆåªæœ‰ä» `document` åˆ° `element` çš„äº‹ä»¶æ•è·å’Œ `element` çš„å†’æ³¡ã€‚æˆ‘ä»¬å†™ä¸€ä¸ª dome éªŒè¯ä¸€ä¸‹

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body{
      position: relative;
      width: 100vw;
      height: 10000px;
      margin: 0;
      background-image: linear-gradient(#e66465, #9198e5);
    }
    #mask{
      position: fixed;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.6);
      top: 0;
      left: 0;
    }
    .modal{
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 50vh;
      background: #fff;
      overflow: scroll;
    }
  </style>
</head>
<body>
  <div id="mask">
    <div class="modal">
      <h1>A</h1>
      <h1>B</h1>
      <h1>C</h1>
      <h1>D</h1>
      <h1>E</h1>
      <h1>F</h1>
      <h1>G</h1>
      <h1>H</h1>
      <h1>I</h1>
      <h1>G</h1>
      <h1>K</h1>
      <h1>L</h1>
      <h1>M</h1>
    </div>
  </div>
</body>
<script>
  var modal = document.querySelector('.modal');

  function log(element, phase) {
    console.log(`scroll handler is trigged in ${element} during ${phase}`)
  }

  function bindEvent(element, elemName) {
    element.addEventListener('scroll', log.bind(null, elemName, 'capture'), true)
    element.addEventListener('scroll', log.bind(null, elemName, 'bubble'))
  }

  bindEvent(window, 'window')
  bindEvent(modal, 'modal')
</script>
</html>
```

![image.png](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/9396646004654e24bd14672845755992~tplv-k3u1fbpfcp-zoom-1.image) 

"ä½†æ˜¯`document`çš„`defaultView`çš„`scroll`äº‹ä»¶å†’æ³¡" è¿™å¥è¯çš„æ„æ€æ˜¯å¦‚æœæ˜¯ `defaultView`é»˜è®¤æ˜¯ window ä¸Šçš„ scroll äº‹ä»¶æ˜¯å†’æ³¡çš„ã€‚ä½†æ˜¯ç”±äºå…¶æœ¬èº«å°±æ˜¯ DOM æ ‘é‡Œæœ€é¡¶çº§çš„å¯¹è±¡ï¼Œå› æ­¤åªèƒ½åœ¨ window é‡Œç›‘è§†scrollçš„æ•è·é˜¶æ®µä»¥åŠå†’æ³¡é˜¶æ®µã€‚ä»£ç çš„è¯åªéœ€è¦å°† body å†… æ”¾ä¸€ä¸ªè¶…å‡ºä¸€å±çš„ divï¼Œç„¶åç›‘å¬ window å’Œ æ­¤ div çš„ scroll äº‹ä»¶å°±å¯ä»¥ã€‚

### IE äº‹ä»¶å¯¹è±¡

IE å°±æ˜¯è¿™ä¹ˆçš„ä¸ä¼—ä¸åŒï¼ˆæ‰‹åŠ¨å±ç¬‘ï¼‰IE äº‹ä»¶å¯¹è±¡æ˜¯æ ¹æ®ä½¿ç”¨çš„äº‹ä»¶å¤„ç†ç¨‹åºä¸åŒè€Œä¸åŒã€‚

- ä½¿ç”¨ DOM0 äº‹ä»¶å¤„ç†ç¨‹åºï¼Œevent å¯¹è±¡æ˜¯å…¨å±€å¯¹è±¡ window çš„ä¸€ä¸ªå±æ€§
- ä½¿ç”¨ `attachEvent()` / HTML å±æ€§æ–¹æ³•å¤„ç†äº‹ä»¶å¤„ç†ç¨‹åºï¼Œevent å¯¹è±¡ä¼šä½œä¸ºå”¯ä¸€çš„å‚æ•°ä¼ ç»™å¤„ç†å‡½æ•°ï¼ˆevent ä»ç„¶æ˜¯ window å¯¹è±¡çš„å±æ€§ï¼Œåªæ˜¯æ–¹ä¾¿å°†å…¶ä½œä¸ºå‚æ•°å‚å…¥ï¼‰

```javascript
var div = document.querySelector('#div');

div.onclick = function(){
  let event = window.event;
  console.log(evennt.type);     // click
}

div.attachEvent('onclick', function(event){
  console.log(event.type);      // click
})
```



# é˜²æ­¢å¼¹çª—åº•éƒ¨æ»šåŠ¨

è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬æœ€åˆæƒ³è§£å†³çš„é—®é¢˜è¿˜è®°å¾—å—ï¼Ÿåœ¨å¼¹å‡ºå±‚å¼¹å‡ºä¹‹åï¼Œæ»šåŠ¨é¡µé¢ï¼Œç”±äºäº‹ä»¶å†’æ³¡ï¼Œæ‰€ä»¥æ»šåŠ¨äº‹ä»¶ä¼šå†’æ³¡åˆ°åº•å±‚å…ƒç´ ï¼ˆé€šå¸¸æ˜¯ bodyï¼‰å°±ä¼šå‡ºç°åº•å±‚å…ƒç´ è·Ÿç€ä¸€èµ·æ»šåŠ¨çš„é—®é¢˜ï¼ˆç§»åŠ¨ç«¯è§¦å‘çš„äº‹ä»¶æ˜¯ touchmoveï¼Œä¸æ˜¯ scrollï¼‰ã€‚ ~~ é‚£ä¹ˆæˆ‘ä»¬æ˜¯å¦èƒ½ç›´æ¥ä½¿ç”¨ `stopPropagation()`é˜»æ­¢äº‹ä»¶å†’æ³¡å°±å¯ä»¥è§£å†³æ»šåŠ¨ç©¿é€çš„é—®é¢˜å‘¢ï¼Ÿï¼Œå¤§å®¶å¯ä»¥è‡ªå·±å†™ dome è¯•éªŒä¸‹ã€‚ç­”æ¡ˆæ˜¯ä¸å¯ä»¥çš„ï¼Œä½¿ç”¨ `stopPropagation()`ç¡®å®æ˜¯å¯ä»¥é˜»æ­¢å†’æ³¡ï¼Œä½†æ˜¯å¯¼è‡´èƒŒæ™¯å±‚æ»šåŠ¨çš„æ˜¯ viewpointã€‚æ‰€ä»¥è™½ç„¶é˜»æ­¢äº†äº‹ä»¶å†’æ³¡ï¼Œä½†æ˜¯è¿˜æ˜¯ä¼šå¯¼è‡´èƒŒæ™¯å±‚è·Ÿéšæ»šåŠ¨çš„ã€‚

æ‰€æœ‰çš„æ»šåŠ¨éƒ½æ˜¯åœ¨ document ä¸Šå½¢æˆäº†ä¸€ä¸ª pending é˜Ÿåˆ—ï¼Œç„¶åæŒ‰ç…§ä¸€å®šçš„è§„åˆ™è§¦å‘ï¼Œè¯¦è§W3Cè§„èŒƒï¼š

> When asked to run the scroll steps for a Document doc, run these steps: For each item target in docâ€™s pending scroll event targets, in the order they were added to the list, run these substeps: If target is a Document, fire an event named scroll that bubbles at target. Otherwise, fire an event named scroll at target. Empty docâ€™s pending scroll event targets.

å½“æˆ‘ä»¬æ»šåŠ¨é¼ æ ‡æ»šè½®ï¼Œæˆ–è€…æ»‘åŠ¨æ‰‹æœºå±å¹•æ—¶ï¼Œè§¦å‘å¯¹è±¡å¯åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼ˆè¯¦è§W3Cè§„èŒƒï¼‰ï¼š

1. viewport è¢«è§¦å‘æ»šåŠ¨ï¼Œ eventTarget ä¸ºå…³è”çš„ Document
2. element å…ƒç´ è¢«è§¦å‘æ»šåŠ¨ï¼Œé€šå¸¸ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ·»åŠ  overflow æ»šåŠ¨å±æ€§çš„ element å…ƒç´ ï¼Œ eventTarget ä¸ºç›¸åº”çš„ node element

æ³¨æ„åˆ°è¿™é‡Œï¼Œåªæœ‰ä¸¤ç§ç±»å‹ï¼Œå½“æˆ‘ä»¬è§¦å‘æ»šè½®æˆ–æ»‘åŠ¨æ—¶ï¼Œå¦‚æœå½“å‰å…ƒç´ æ²¡æœ‰è®¾ç½® overflow è¿™æ ·çš„å±æ€§ï¼ŒåŒæ—¶ä¹Ÿæ²¡æœ‰ preventDefault æ‰åŸç”Ÿçš„æ»šåŠ¨/æ»‘åŠ¨äº‹ä»¶ï¼Œé‚£ä¹ˆæ­¤æ—¶è§¦å‘çš„æ˜¯ viewport çš„æ»šåŠ¨ï¼Œposition:fixed çš„å…ƒç´ å¹¶æ²¡æœ‰ä»€ä¹ˆä¾‹å¤–ã€‚

ç”±æ­¤å¯è§ï¼Œæ»šåŠ¨ç©¿é€é—®é¢˜å…¶å®å¹¶ä¸æ˜¯ä¸€ä¸ªæµè§ˆå™¨çš„bugï¼ˆè™½ç„¶åœ¨iosä¸‹fixedå®šä½ç¡®å®ä¼šå¯¼è‡´å¾ˆå¤šbugï¼‰ï¼Œå®ƒæ˜¯å®Œå…¨ç¬¦åˆè§„èŒƒçš„ï¼Œæ»šåŠ¨çš„åŸåˆ™åº”è¯¥æ˜¯ scrollforwhat can scrollï¼Œä¸åº”è¯¥å› ä¸ºæŸä¸ªå…ƒç´ çš„ CSS å®šä½å¯¼è‡´æ»šè½®å¤±æ•ˆæˆ–è€…æ»‘åŠ¨å¤±æ•ˆã€‚

é‚£ä¹ˆå¦‚æœä¸æ˜¯äº‹ä»¶å†’æ³¡ï¼Œä¸ºä»€ä¹ˆä¼šå‘ç”Ÿæ»šåŠ¨ç©¿é€çš„é—®é¢˜å‘¢ï¼Ÿå¦‚æœå½“å‰æ»šåŠ¨çš„å…ƒç´ å¯ä»¥æ»šåŠ¨ï¼Œé‚£ä¹ˆå°±ä¼šåœ¨å½“å‰å…ƒç´ è§¦å‘ scroll äº‹ä»¶ã€‚å¦‚æœå½“å‰çš„å…ƒç´ ä¸èƒ½æ»šåŠ¨ï¼ˆæˆ–æ»šåŠ¨åˆ°è¾¹ç•Œä¸èƒ½å†ç»§ç»­æ»šåŠ¨ï¼‰ï¼Œé‚£ä¹ˆå°±ä¼šæ»šåŠ¨å¤–å±‚å…ƒç´ ã€‚

é‚£ä¹ˆè¿˜æœ‰ä¸€ä¸ªè§£å†³åŠæ³•ï¼Œç›´æ¥ä½¿ç”¨ `e.preventDefault()` é˜»æ­¢æ‰å¼¹å‡ºå±‚é»˜è®¤çš„æ»šåŠ¨äº‹ä»¶ã€‚

## preventDefault é˜»æ­¢å¼¹å‡ºå±‚é»˜è®¤çš„æ»šåŠ¨äº‹ä»¶ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body{
      position: relative;
      width: 100vw;
      height: 10000px;
      margin: 0;
      background-image: linear-gradient(#e66465, #9198e5);
    }
    #mask{
      position: fixed;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.6);
      top: 0;
      left: 0;
    }
  </style>
</head>
<body>
  <div id="mask"> mask </div>
</body>
<script>
  var mask = document.querySelector('#mask');

  mask.addEventListener("touchmove", (e) => {
    e.preventDefault()
  }, {
    passive: false
  });
</script>
</html>
```

æœ‰ä¸€ä¸ªå°ç»†èŠ‚æ˜¯æˆ‘ä»¬å°† `addEventListener`æœ€åä¸€ä¸ªå‚æ•°è®¾ç½®ä¸ºäº† `{ passive: false }` ï¼Œè¿™é‡Œæ˜¯ä¸€ä¸ªå°ä¼˜åŒ–ï¼š[ç½‘ç«™ä½¿ç”¨è¢«åŠ¨äº‹ä»¶ç›‘å¬å™¨ä»¥æå‡æ»šåŠ¨æ€§èƒ½](https://web.dev/uses-passive-event-listeners/)ã€‚

ä½†æ˜¯ä½¿ç”¨è¿™ä¸ªæ–¹æ³•è¿˜æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š

- å› ä¸ºé˜»æ­¢æ‰äº†å¼¹å‡ºå±‚çš„ touch eventï¼Œæ‰€ä»¥å¼¹å‡ºå±‚å†…çš„æ»šåŠ¨ä¹Ÿä¼šå¤±æ•ˆ
- å¼¹å‡ºå±‚æ»šåŠ¨åˆ°æœ€ä¸‹æ–¹çš„æ—¶å€™è¿˜æ˜¯èƒ½å¤Ÿè§¦å‘ body çš„æ»šåŠ¨çš„ã€‚

æ‰€ä»¥æˆ‘ä»¬è¿˜è¦è¿›è¡Œä¼˜åŒ–ï¼Œæ¥ç¡®å®šä»€ä¹ˆæ—¶å€™ç¦æ­¢æ»šåŠ¨ï¼šæ»šåŠ¨åˆ°è¾¹ç•Œï¼ˆä¸Š ä¸‹ å·¦ å³ï¼‰çš„æ—¶å€™ï¼Œå¦‚æœç»§ç»­æ»šåŠ¨å°±ç¦æ­¢ğŸš«ã€‚

```html
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>
  <style>
    body{
      position: relative;
      width: 100vw;
      height: 10000px;
      margin: 0;
      background-image: linear-gradient(#e66465, #9198e5);
    }
    #mask{
      position: fixed;
      width: 100vw;
      height: 100vh;
      background-color: rgba(0, 0, 0, 0.6);
      top: 0;
      left: 0;
    }
    .modal{
      position: fixed;
      top: 0;
      left: 0;
      width: 100vw;
      height: 50vh;
      background: #fff;
      overflow: scroll;
    }
  </style>
</head>
<body>
  <div id="mask">
    <div class="modal">
      <h1>A</h1>
      <h1>B</h1>
      <h1>C</h1>
      <h1>D</h1>
      <h1>E</h1>
      <h1>F</h1>
      <h1>G</h1>
      <h1>H</h1>
      <h1>I</h1>
      <h1>G</h1>
      <h1>K</h1>
      <h1>L</h1>
      <h1>M</h1>
    </div>
  </div>
</body>
<script>
  var mask = document.querySelector('#mask');
  var modal = document.querySelector('.modal');

  // è®°å½•åˆæ¬¡touchçºµåæ ‡
  let startY = 0;

  const modalHeight = modal.clientHeight;
  const modalScrollHeight = modal.scrollHeight;

  modal.addEventListener("touchstart", (e) => {
    startY = e.touches[0].pageY;
  })

  mask.addEventListener("touchmove", (e) => {
    let endY = e.touches[0].pageY;
    let delta = endY - startY;

    if(
      (modal.scrollTop === 0 && delta > 0) ||
      (modal.scrollTop + modalHeight === modalScrollHeight &&
                    delta < 0)
    ){
      e.preventDefault()
    }
  }, true);
</script>
</html>
```



## è®¾ç½® body çš„ overflow: hidden

è¿™ç§æ–¹å¼å…¶å®æ¯”è¾ƒæš´åŠ›ï¼Œåœ¨å¼¹çª—å¼¹å‡ºçš„æ—¶å€™ï¼Œæ‰‹åŠ¨ä¿®æ”¹ body çš„æ ·å¼ï¼Œç„¶åè®°å¾—åœ¨å¼¹çª—å…³é—­çš„æ—¶å€™å°† body çš„æ ·å¼æ›´æ”¹å›å»ã€‚

psï¼šæˆ‘å·æ‡’ç›´æ¥jsæ§åˆ¶äº†è¡Œé—´æ ·å¼ï¼Œä½†æ ‡å‡†å†™æ³•åº”è¯¥æ˜¯ç»™bodyæ·»åŠ ç±»åæ¥æ§åˆ¶

```javascript
// åº•éƒ¨ä¸æ»‘åŠ¨
const bodyEl = document.querySelector('body');
let top = 0;

const stopBodyScroll = (isFixed: boolean) => {
  if (isFixed) {
    top = window.scrollY
    bodyEl && (bodyEl.style.position = 'fixed')
    bodyEl && (bodyEl.style.top = -top + 'px')
  } else {
    bodyEl && (bodyEl.style.position = '')
    bodyEl && (bodyEl.style.top = '')

    window.scrollTo(0, top) // å›åˆ°åŸå…ˆçš„top
  }
}
```

è¿™ä¸ªæ–¹æ³•è¿˜å¯ä»¥æ”¹è¿›ï¼Œå› ä¸ºæˆ‘ä»¬æ¯æ¬¡ä¸ä¸€å®šæ˜¯è§¦å‘çš„ body çš„æ»šåŠ¨ï¼Œä¹Ÿå¯ä»¥æ˜¯å…¶ä»–å…ƒç´ å¯¼è‡´çš„æ»šåŠ¨ã€‚å…¶æ¬¡æ˜¯è¦è®°å½•è¢«æ»šåŠ¨å…ƒç´ ä¹‹å‰çš„æ ·å¼ï¼ˆpositionï¼‰ä¸èƒ½ä¸€å‘³çš„å°†å…¶è®¾ç½®ä¸ºç©ºã€‚